{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="stylesheet" href="{% static 'puffer/dist/css/bootstrap.min.css' %}">
  <title>Puffer</title>
  <link rel="icon" href="{% static 'puffer/dist/images/favicon.ico' %}">
</head>

<body>
  <!-- Navigation -->
  {% include "puffer/navigation.html" %}

  <!-- User Info -->
  <div class="container py-5">
    <p>Your username: {{ user.username }}</p>
    <p>
      Puffer uses an invitation token based system to allow users to invite other users.
      If you have any invitation tokens, they will show up below. Feel free to share them with
      friends who would also like to use Puffer.
    </p>
    {% if user.is_superuser %}
    <p>As an admin, you can click <a href="{% url 'generate_token' %}">
       this link</a> to generate additional invite tokens.</p>
    {% endif %}
    <div>
      {% if user.invitationtoken_set.all %}
      <a data-toggle="collapse" href="#collapse-tokens"
         aria-expanded="false" aria-controls="collapse-tokens">
        Available invitation tokens: {{ user.invitationtoken_set.all.count }}
      </a>
      <div class="collapse" id="collapse-tokens">
        <p>Unshared tokens (Once you share one, click it to mark it shared):</p>
        <ul class="list-group" id="unshared">
        {% for t in user.invitationtoken_set.all %}
          {% if not t.shared %}
            <li class="list-group-item">
              <div class="d-flex bd-highlight">
              {% if t.addon_cnt %}
                <div class="p-2 flex-fill bd-highlight">
                  {{ t.token }} (this token will generate {{ t.addon_cnt }}
                  additional tokens)
                </div>
              {% else %}
                <div class="p-2 flex-fill bd-highlight">
                  {{ t.token }}
                </div>
              {% endif %}
                <div class="p-2 flex-fill bd-highlight">
                  <button onclick="share('{{ t.token }}', this, '{{ csrf_token }}')"
                          type="button" class="btn btn-link">
                    mark shared
                  </button>
                </div>
            </li>
          {% endif %}
        {% endfor %}
        </ul>

        <br>
        <p>Shared but not yet used tokens (Click to mark unshared):</p>
        <ul class="list-group" id="shared">
        {% for t in user.invitationtoken_set.all %}
          {% if t.shared %}
            <li class="list-group-item">
              <div class="d-flex bd-highlight">
              {% if t.addon_cnt %}
                <div class="p-2 flex-fill bd-highlight">
                  {{ t.token }} (this token will generate {{ t.addon_cnt }}
                  additional tokens)
                </div>
              {% else %}
                <div class="p-2 flex-fill bd-highlight">
                  {{ t.token }}
                </div>
              {% endif %}
                <div class="p-2 flex-fill bd-highlight">
                  <button onclick="unshare('{{ t.token }}', this, '{{ csrf_token }}')"
                          type="button" class="btn btn-link">
                    mark unshared
                  </button>
                </div>
            </li>
          {% endif %}
        {% endfor %}
        </ul>
      </div>
      {% else %}
      <a href="{% url 'participate' %}">Have friends interested in Puffer?</a>
      {% endif %}
    </div>
  </div>

  <script src="{% static 'puffer/dist/js/jquery-3.3.1.slim.min.js' %}"></script>
  <script src="{% static 'puffer/dist/js/bootstrap.min.js' %}"></script>
  <script src="{% static 'puffer/js/profile.js' %}"></script>
</body>

</html>
